def transcribe_audio():
    if 'audio' not in request.files:
        return jsonify({"error": "No audio file provided"}), 400

    audio_file = request.files['audio']

    try:
        # Convert webm to wav
        audio = AudioSegment.from_file(audio_file, format="webm")
        wav_io = io.BytesIO()
        audio.export(wav_io, format="wav")
        wav_io.seek(0)

        # Check if the audio is too quiet
        loudness = audio.dBFS
        print("Audio loudness:", loudness)
        if loudness < -35:
            return jsonify({"transcription": ""})

        audio = AudioSegment.from_file(wav_io, format="wav")
        samples = np.array(audio.get_array_of_samples()).astype(np.float32) / (1 << (8 * audio.sample_width - 1))

        # Convert mono/stereo appropriately
        if audio.channels > 1:
            samples = samples.reshape((-1, audio.channels))
            samples = samples.mean(axis=1)  # convert to mono

        # Transcribe using faster-whisper with raw numpy array and sample rate
        segments, _ = model.transcribe(samples, language="en", beam_size=1, sample_rate=audio.frame_rate)

        transcription = "".join([segment.text for segment in segments]).strip()

        if not transcription:
            transcription = "No speech detected"

        print("Transcription:", transcription)
        return jsonify({"transcription": transcription})













    <Card className="rounded-2xl overflow-hidden shadow-[5px_5px_15px_rgba(0,0,0,0.05),_-5px_-5px_15px_rgba(255,255,255,0.8)] border border-purple-100">
                <CardHeader className="bg-[hsl(var(--attune-light-purple))] text-white pb-3">
                  <CardTitle className="text-xl">Summary</CardTitle>
                  <CardDescription className="text-white text-opacity-80">{getTimeRangeTitle()}</CardDescription>
                </CardHeader>
                <CardContent className="pt-4">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-lg text-gray-600">Understanding</span>
                    <span className="text-2xl font-bold text-[hsl(var(--attune-purple))]">{understandingPercentage}%</span>
                  </div>
                  <div className="relative h-4 bg-gray-200 rounded-full overflow-hidden mb-4">
                    <div 
                      className="absolute top-0 left-0 h-full bg-green-500" 
                      style={{ width: `${understandingPercentage}%` }}
                    ></div>
                  </div>
                  <Table>
                    <TableHeader>
                      <TableRow>
                        <TableHead>Status</TableHead>
                        <TableHead className="text-right">Time</TableHead>
                        <TableHead className="text-right">Percentage</TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      <TableRow>
                        <TableCell className="flex items-center gap-1">
                          <Eye size={14} className="text-green-600" /> Attentive
                        </TableCell>
                        <TableCell className="text-right">{timeProps.attentive}</TableCell>
                        <TableCell className="text-right">{timeProps.attentivePerc}</TableCell>
                      </TableRow>
                      <TableRow>
                        <TableCell className="flex items-center gap-1">
                          <AlertTriangle size={14} className="text-red-600" /> Confused
                        </TableCell>
                        <TableCell className="text-right">{timeProps.confused}</TableCell>
                        <TableCell className="text-right">{timeProps.confusedPerc}</TableCell>
                      </TableRow>
                      <TableRow>
                        <TableCell className="flex items-center gap-1">
                          <Activity size={14} className="text-yellow-600" /> Inattentive
                        </TableCell>
                        <TableCell className="text-right">{timeProps.inattentive}</TableCell>
                        <TableCell className="text-right">{timeProps.inattentivePerc}</TableCell>
                      </TableRow>
                    </TableBody>
                  </Table>
                </CardContent>
              </Card>
            </div>